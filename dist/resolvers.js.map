{"version":3,"sources":["../src/resolvers.js"],"names":["resolvers","Query","getAllProducts","_","inStock","Product","find","$gt","getProduct","title","query","findOne","then","doc","ApolloError","getCart","username","user","Cart","getUsers","User","Mutation","createProduct","input","create","updateProduct","console","log","findOneAndUpdate","new","error","purchaseProduct","quantity","result","inventory_count","update","$inc","deleteProduct","deleteMany","deleteAll","remove","createUser","createCart","addToCart","productQuery","toString","price","subTotal","$push","items","total","completeCart","cart","length","item"],"mappings":"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","file":"resolvers.js","sourcesContent":["import Product from './models/product';\r\nimport Cart from './models/cart';\r\nimport User from './models/user';\r\n\r\nimport { ApolloError } from 'apollo-server'\r\n\r\nexport const resolvers = {\r\n    Query: {\r\n        async getAllProducts(_, { inStock }) {\r\n            if (!inStock) {\r\n                return await Product.find()\r\n            } else {\r\n                return await Product.find({\r\n                    \"inventory_count\" : { $gt: 0 }\r\n                })\r\n            }\r\n            \r\n        },\r\n        async getProduct(_, { title }) {\r\n            var query = { title: title }\r\n            return await Product.findOne(query).then( (doc) => { //TODO: fix error with error\r\n                if (!doc) {\r\n                    throw new ApolloError(\"The product does not exist!\");\r\n                }\r\n                \r\n                return doc;\r\n            });\r\n        },\r\n        async getCart(_, { username }) {\r\n            var query = { user: username }\r\n            return await Cart.findOne(query).then( (doc) => {\r\n                if (!doc) {\r\n                    throw new ApolloError(`There is no cart for ${username}.`)\r\n                }\r\n            });\r\n        },\r\n        async getUsers() {\r\n            return await User.find();\r\n        }\r\n    },\r\n    Mutation: {\r\n        async createProduct(_, { input }) {\r\n            return await Product.create(input);\r\n        },\r\n        async updateProduct(_, { title, input }) { \r\n            var query = { title: title };\r\n            console.log(input);\r\n            return await Product.findOneAndUpdate(query, input, {new: true}, (error, doc) => {\r\n                if (error) {\r\n                    throw new ApolloError(\"There was an error updating the product!\");\r\n                }\r\n                if (!doc) {\r\n                    throw new ApolloError(\"That product does not exist!\");\r\n                }\r\n                else {\r\n                    return doc;\r\n                }\r\n            });\r\n        },\r\n        async purchaseProduct(_, { title, quantity }) {\r\n            var query = { title: title };\r\n            let result = await Product.findOne(query);\r\n            if (!result) {\r\n                throw new ApolloError(\"This item does not exist!\")\r\n            }\r\n            if (result.inventory_count <= 0) {\r\n                throw new ApolloError(\"This item is out of stock!\");\r\n            }\r\n            else {\r\n                return await Product.update(\r\n                    query,\r\n                    { \r\n                        $inc: { inventory_count: -quantity }\r\n                    },\r\n                );\r\n            }\r\n        },\r\n        async deleteProduct(_, { title }) {\r\n            var query = { title: title }\r\n            return await Product.deleteMany(query);\r\n        },\r\n        async deleteAll() {\r\n            return await Product.remove({});\r\n        },\r\n        async createUser(_, { input }) {\r\n            return await User.create(input);\r\n        },\r\n        async createCart(_, { username }) {\r\n            var query = { username: username }\r\n            let user =  await User.findOne(query);\r\n\r\n            if (!user) {\r\n                throw new ApolloError(\"No such user exists!\");\r\n            }\r\n            return await Cart.create({\r\n                user: username,\r\n            });\r\n        },\r\n        async addToCart(_, { username, input }) {\r\n            var productQuery = { title: input.title.toString() }\r\n            var { price, inventory_count } = await Product.findOne(productQuery);\r\n            var subTotal = price*input.quantity\r\n            var query = { user: username }\r\n\r\n            if (inventory_count <= 0) {\r\n                throw new ApolloError(\"This item is out of stock!\");\r\n            }\r\n\r\n            if (input.quantity > inventory_count) {\r\n                throw new ApolloError(`There is only ${inventory_count} left in stock!`);\r\n            }\r\n\r\n            return await Cart.findOneAndUpdate(\r\n                query,\r\n                {\r\n                    $push: { \r\n                        items: {\r\n                            title: input.title,\r\n                            quantity: input.quantity,\r\n                            subTotal: subTotal,\r\n                        }\r\n                    },\r\n                    $inc: { total: subTotal }\r\n                }\r\n            );\r\n        },\r\n        async completeCart(_, { username }) {\r\n            var query = { user: username }\r\n\r\n            let cart =  await Cart.findOne(query);\r\n            if (!cart) {\r\n                throw new ApolloError(\"Cart does not exist!\");\r\n            }\r\n            let items = cart.items;\r\n            if (!items.length) {\r\n                throw new ApolloError(\"Cannot complete an empty cart!\");\r\n            }\r\n            \r\n            for (let item of items) {\r\n                await Product.findOneAndUpdate(\r\n                    { title: item.title },\r\n                    {\r\n                        $inc: { inventory_count: -item.quantity }\r\n                    }\r\n                    \r\n                );\r\n            }\r\n\r\n            let total = cart.total;\r\n            cart.remove();\r\n\r\n            return `Cart completed successfully, total was: $${total}`\r\n        }\r\n    }\r\n}"]}